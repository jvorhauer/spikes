akka {
  extensions = [akka.persistence.Persistence]

  log-dead-letters = 10
  log-dead-letters-during-shutdown = on
  log-config-on-start = off
  loggers = ["akka.event.Logging$DefaultLogger"]
  loglevel = INFO
  stdout-loglevel = INFO

  actor {
    serializers {
      jackson-cbor = "akka.serialization.jackson.JacksonCborSerializer"
      akka-projection = "akka.projection.internal.ProjectionSerializer"
    }
    serialization-bindings {
      "spikes.model.CborSerializable" = jackson-cbor
      "akka.projection.ProjectionBehavior$Internal$ProjectionManagementCommand" = akka-projection
      "akka.projection.ProjectionBehavior$Internal$CurrentOffset" = akka-projection
    }
  }

  persistence {
    journal {
      plugin = "akka.persistence.cassandra.journal"
      auto-start-journals = ["akka.persistence.cassandra.journal"]
    }
    cassandra {
      session-provider = "akka.stream.alpakka.cassandra.DefaultSessionProvider"
      session-dispatcher = "akka.persistence.cassandra.default-dispatcher"
      datastax-java-driver-config = "datastax-java-driver"

      query {
        refresh-interval = 2s
      }
      events-by-tag {
        eventual-consistency-delay = 25ms
        flush-interval = 25ms
        pubsub-notification = on
        bucket-size = 1m
      }

    }
    snapshot-store {
      plugin = "akka.persistence.snapshot-store.local"
      auto-start-snapshot-stores = ["akka.persistence.snapshot-store.local"]
    }
  }
}

datastax-java-driver {
  basic {
    session-keyspace = "akka"
    cloud {
      secure-connect-bundle = ${ASTRA_SCB}
    }
  }
  advanced {
    auth-provider {
      class = PlainTextAuthProvider
      username = ${ASTRA_USERNAME}
      password = ${ASTRA_PASSWORD}
    }
    reconnect-on-init = true
  }
}


h2projection {
  profile = "slick.jdbc.H2Profile$"
  db {
    url = "jdbc:h2:mem:projection"
    driver = org.h2.Driver
    connectionPool = disabled
    keepAliveConnection = true
  }
}

h2state {
  profile = "slick.jdbc.H2Profile$"
  db {
    url = "jdbc:h2:mem:state"
    driver = org.h2.Driver
    connectionPool = disabled
    keepAliveConnection = true
  }
}
